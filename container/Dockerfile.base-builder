FROM ghcr.io/astral-sh/uv:0.8.22 AS uv

ARG BASE_IMAGE=ffreis/base
FROM ${BASE_IMAGE}

USER root

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
      python3 \
      python3-venv \
      ca-certificates && \
    install -d -m 0750 -o appuser -g appgroup /opt/venv && \
    rm -rf /var/lib/apt/lists/*

COPY --from=uv /uv /usr/local/bin/uv

ENV PYTHONUNBUFFERED=1

USER appuser:appgroup
